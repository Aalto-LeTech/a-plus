{% extends "course/course_base.html" %}
{% load i18n %}
{% load exercise_info %}

{% block coursecontent %}

<div class="row">
    <div class="span10">
        <ul class="breadcrumb">
            <li>
                <a href="{% url 'course' course_url=course.url instance_url=instance.url %}">
                	{{ course.name }}
                </a>
            </li>
            <li>
                <a href="{% url 'exercise.staff_views.list_exercise_submissions' course_url=course.url instance_url=instance.url exercise_id=exercise.id %}">
                	{{ exercise.name }}
                </a>
            </li>
            <li class="active">
                {% trans "Submission" %} {{ submission.id }}
            </li>
        </ul>
    </div>
</div>

<div class="row">
    <div class="span4" id="student-submission">
        <h2>{% trans "Submission" %}</h2>
        
        <div class="well">
            {% if is_teacher or is_assistant and submission.exercise.allow_assistant_grading %}
            <p>
                <a class="btn btn-primary" href="{% url 'exercise.staff_views.assess_submission' course_url=course.url instance_url=instance.url exercise_id=exercise.id submission_id=submission.id %}">
                	{% trans "Assess this submission" %}
                </a>
            </p>
            {% endif %}
            
            <hr />
            
            <h3>{% trans "General information" %}</h3>
            <dl>
                <dt>{% trans "Submitters" %}</dt>
                <dd>{{ submission.submitters.all|students }}</dd>
            </dl>
            <dl>
                <dt>{% trans "Status" %}</dt>
                <dd>{{ submission.status }}</dd>
            </dl>
            <dl>
                <dt>{% trans "Submission time" %}</dt>
                <dd>{{ submission.submission_time }}</dd>
            </dl>
            <dl>
                <dt>{% trans "Grade" %}</dt>
                <dd>{{ submission.grade }} / {{ submission.exercise.max_points }}</dd>
            </dl>
            {% if submission.late_penalty_applied %}
            <dl>
                <dt>{% trans "Includes late penalty" %}</dt>
                <dd>-{{ submission.late_penalty_applied|percent }}%</dd>
            </dl>
            {% endif %}
            
            <hr />
            
            <h3>{% trans "Submitted files" %}</h3>
            <ul class="unstyled">
                {% for file in submission.files.all %}
                <li>
                	<i class="icon-file"></i>
                    <a href="{{ file.get_absolute_url }}">{{ file.filename }}</a>
                    ({{ file.file_object.size|filesizeformat }})
                </li>
                {% empty %}
                <li>
                    {% trans "No files" %}
                </li>
                {% endfor %}
            </ul>
            
            <hr />
            
            <h3>{% trans "Submitted values" %}</h3>
            <dl>
            	{% for item in submission.submission_data %}
                <dt>{{ item.0 }}</dt>
                <dd>{{ item.1 }}</dd>
            	{% empty %}
                <dt>{% trans "No values" %}</dt>
            	{% endfor %}
            </dl>
            
            <hr />
            
            <h3>Re-Submit to Service</h3>
            <p>
            	{% blocktrans %}
                Click this button to re-submit this submission to the assessment
                service. This is meant to be used only in situations where the
                assessment service has behaved incorrectly so that the grading
                data is incorrect or the status of the submission never became
                ready. Caution! Re-submitting overwrites the current grading data.
                {% endblocktrans %}
            </p>
            <p>
            	<form method="post" action="{% url 'exercise.staff_views.resubmit_to_service' course_url=course.url instance_url=instance.url exercise_id=exercise.id submission_id=submission.id %}">
            		{% csrf_token %}
            		<input class="btn btn-primary" type="submit" value="{% trans 'Re-Submit to Service' %}" />
            	</form>
            </p>

            <hr />

            <h3>{% trans "Grading data" %}</h3>
            <dl>
            	{% for item in submission.grading_data.items %}
                <dt>{{ item.0 }}</dt>
                <dd>{{ item.1 }}</dd>
            	{% empty %}
                <dt>{% trans "No values" %}</dt>
            	{% endfor %}
            </dl>
        </div>
    </div>
    
    <div class="span6" id="generated-feedback">
        <h2>{% trans "Feedback" %}</h2>
        <div class="well">
        
            {% if submission.assistant_feedback %}
            <h2>Assistant feedback</h2>
            {{ submission.assistant_feedback|safe }}
            {% else %}
            <div class="alert alert-info">
            	{% trans "No assistant feedback available for this submission." %}
            </div>
            {% endif %}

        	{% if submission.feedback %}
            <h2>Grader feedback</h2>
            {{ submission.feedback|safe }}
        	{% else %}
            <div class="alert alert-info">
            	{% trans "No grader feedback available for this submission." %}
            </div>
        	{% endif %}
        
        </div>
    </div>
</div>
{% endblock %}
